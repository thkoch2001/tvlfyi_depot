# needs export BQNLIBS=/path/to/mlochbaum/bqn-libs
âŸ¨ReadDec,ImportBqnLibsâŸ© â† â€¢Import "../../lib.bqn"
âŸ¨SplitâŸ© â† ImportBqnLibs "strings.bqn"
MakeOp â† {
  ğ•Š aâ€¿"+"â€¿b: ğ•Š aâ€¿+â€¿b;
  ğ•Š aâ€¿"*"â€¿b: ğ•Š aâ€¿Ã—â€¿b;
  ğ•Š aâ€¿opâ€¿b:
  isâ€¿xs â† (<"old") (â‰¡Â¨âŠ”âŠ¢) aâ€¿b
  {opÂ´ (ğ•©â‹†â‰ xs) âˆ¾ReadDecÂ¨ is}
}
ParseMonkey â† {
  Â·â€¿itemsâ€¿opâ€¿ifâ€¿thenâ€¿else:
  {
    initial â‡ ReadDecÂ¨ ", " Split 18â†“items
    op â‡ MakeOp " " Split 19â†“op
    if â‡ ReadDec 21â†“if
    then â‡ ReadDec 29â†“then
    else â‡ ReadDec 30â†“else
  }
}
monkeys â† ParseMonkeyÂ¨ 1â†“' '((+`(â‰ âŸœâŠ‘)Â¨)âŠ”âŠ¢)0(â‰ âŸœâ‰ Â¨/âŠ¢)â€¢FLines "input"
items â† {ğ•©.initial}Â¨ monkeys
lim â† Ã—Â´{ğ•©.if}Â¨ monkeys

Sim â† {
  div ğ•Š len:
  Turn â† {
    items ğ•Š turnidx:
    i â† (â‰ monkeys)|turnidx
    m â† iâŠ‘monkeys

    worry â† lim|âŒŠdivÃ·Ëœ m.OpÂ¨ iâŠ‘items
    elseâ€¿then â† 2â†‘0 (=âŸœ(m.ifâŠ¸|)âŠ”âŠ¢) worry

    âŸ¨then, elseâŸ©âŠ¸(âˆ¾ËœÂ¨)âŒ¾(m.thenâ€¿m.elseâŠ¸âŠ) âŸ¨âŸ©Ë™âŒ¾(iâŠ¸âŠ‘) items
  }
  Ã—Â´2â†‘âˆ¨+Ë(<items) ((â‰ âŠ‘)âŠ¸(>((â†•âŠ£)=|)Â¨)Ã—(â‰ Â¨Ë˜)âˆ˜>âˆ˜(âŠ£Â»Turn`)) â†•lenÃ—â‰ items
}

â€¢Out "day11.1: "âˆ¾â€¢Fmt 3 Sim 20
â€¢Out "day11.2: "âˆ¾â€¢Fmt 1 Sim 10000
