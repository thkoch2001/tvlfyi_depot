#!/usr/bin/env BQN

#
# Utilities
#

IsAsciiNum â† ('0'âŠ¸â‰¤âˆ§â‰¤âŸœ'9')

ReadInt â† {(ğ•¨âŠ¸Ã—+âŠ£)Â´âˆ˜âŒ½-âŸœ'0'ğ•©} # stolen from leah2
ReadDec â† 10âŠ¸ReadInt

ReadInput â† {â€¢file.Lines âˆ¾ â€¢pathâ€¿"/input/day"â€¿(â€¢Fmt ğ•©)}

SplitOn â† ((âŠ¢ (-1Ë™)âŸâŠ£Â¨ +`)âˆ˜=âŠ”âŠ¢)

_fix â† {ğ•©â‰¡ ğ”½ğ•©?ğ•©;ğ•Š ğ”½ ğ•©} # stolen from leah2

#
# 2021-12-01
#

# part 1

day1ExampleData â† 199â€¿200â€¿208â€¿210â€¿200â€¿207â€¿240â€¿269â€¿260â€¿263
day1Input â† ReadDecÂ¨ReadInput 1

# NB: Because distance from the ground is never smaller than zero, it's
# no problem that nudge inserts a zero at the end of the right list
PositiveDeltaCount â† +Â´âˆ˜(âŠ¢<Â«)+ËË˜âˆ˜â†•

! 7 = 1 PositiveDeltaCount day1ExampleData

â€¢Out "Day 1.1: "âˆ¾â€¢Fmt 1 PositiveDeltaCount day1Input

# part 2

! 5 = 3 PositiveDeltaCount day1ExampleData

â€¢Out "Day 1.2: "âˆ¾â€¢Fmt 3 PositiveDeltaCount day1Input

#
# 2021-12-02
#

# part 1

day2ExampleData â† âŸ¨
  "forward 5",
  "down 5",
  "forward 8",
  "up 3",
  "down 8",
  "forward 2",
âŸ©

day2Input â† ReadInput 2

ParseSubmarineCommand â† (((â†•2)âŠ¸((((-1)âŠ¸â‹†)âˆ˜(2âŠ¸|))Ã—(=âŸœ(âŒŠâˆ˜(Ã·âŸœ2))))âˆ˜("duf"âŠ¸âŠ)âˆ˜âŠ‘)Ã—ReadDecâˆ˜(IsAsciiNum/âŠ¢))

SubmarineDestProduct â† {Ã—Â´+Â´ParseSubmarineCommandÂ¨ğ•©}

! 150 = SubmarineDestProduct day2ExampleData

â€¢Out "Day 2.1: "âˆ¾â€¢Fmt SubmarineDestProduct day2Input

# part 2

SubmarineAimedDestProduct â† {
  Ã—Â´+Â´((Ã—Â´)âˆ˜(1âŠ¸â†“)â‰(1âŠ¸âŠ‘))Â¨ (<0â€¿0â€¿0) (âŠ¢âˆ¾((âŠ‘âˆ˜âŒ½âŠ£)+(âŠ‘âŠ¢)))` ParseSubmarineCommandÂ¨ğ•©
}

! 900 = SubmarineAimedDestProduct day2ExampleData

â€¢Out "Day 2.2: "âˆ¾â€¢Fmt SubmarineAimedDestProduct day2Input

#
# 2021-12-03
#

BinTable â† '0'-Ëœ>

day3ExampleData â† BinTable âŸ¨
  "00100",
  "11110",
  "10110",
  "10111",
  "10101",
  "01111",
  "00111",
  "11100",
  "10000",
  "11001",
  "00010",
  "01010",
âŸ©

day3Input â† BinTable ReadInput 3

DeBinList â† ((2âŠ¸Ã—)+âŠ£)Â´âŒ½
_tableAggr â† {((Ã·âŸœ2)âˆ˜(/âŸœâ¥Š)Â´âˆ˜âŒ½âˆ˜â‰¢ğ”½(+Ë))ğ•©}
GammaRate â† < _tableAggr

! 22 = DeBinList GammaRate day3ExampleData
! 9  = DeBinList Â¬GammaRate day3ExampleData

â€¢Out "Day 3.1: "âˆ¾â€¢Fmt (Â¬Ã—â—‹DeBinListâŠ¢) GammaRate day3Input

_lifeSupportRating â† {
  # Need to rename the arguments, otherwise the ternary expr becomes a function
  bitPos â† ğ•¨
  Cmp â† ğ”½

  crit â† Cmp _tableAggr ğ•©
  matchPos â† bitPos âŠ‘Ë˜ crit ((â¥ŠËœâŸœâ‰¢)=âŠ¢) ğ•©
  match â† matchPos/ğ•©
  {1=â‰ match?âŠmatch;(bitPos+1) Cmp _lifeSupportRating match}
}

OxygenGeneratorRating â† DeBinList 0 â‰¤_lifeSupportRating âŠ¢
CO2ScrubberRating â† DebinList 0 >_lifeSupportRating âŠ¢

! 23 = OxygenGeneratorRating day3ExampleData
! 10 = CO2ScrubberRating day3ExampleData

â€¢Out "Day 3.2: "âˆ¾â€¢Fmt (OxygenGeneratorRatingÃ—CO2ScrubberRating) day3Input

#
# 2021-12-07
#

# part 1

day6ExampleData â† âŸ¨16,1,2,0,4,2,7,1,2,14âŸ©
day6Input â† ReadDecÂ¨ ','  SplitOn âŠ‘ReadInput 6

PossiblePositions â† (âŒŠÂ´+âŸœ(â†•1âŠ¸+)âŒˆÂ´)
FuelConsumption â† +Ëâˆ˜|âˆ˜(-âŒœ)
_lowestFuelPossible â† {âŒŠÂ´âˆ˜(ğ”½âŸœPossiblePositions)Ëœ ğ•©}

! 37 = FuelConsumption _lowestFuelPossible day6ExampleData

â€¢Out "Day 7.1: "âˆ¾â€¢Fmt FuelConsumption _lowestFuelPossible day6Input

# part 2

TriNum â† 1âŠ¸+Ã—Ã·âŸœ2

FuelConsumption2 â† +Ëâˆ˜(TriNumÂ¨)âˆ˜|âˆ˜(-âŒœ)

! 168 = FuelConsumption2 _lowestFuelPossible day6ExampleData

â€¢Out "Day 7.2: "âˆ¾â€¢Fmt FuelConsumption2 _lowestFuelPossible day6Input

#
# 2021-12-09
#

# part 1

ParseHeightMap â† ((â‰ â‰(â‰ âŠ‘))â¥Šâˆ¾)âˆ˜-âŸœ'0'

day9ExampleData â† ParseHeightMap âŸ¨
  "2199943210",
  "3987894921",
  "9856789892",
  "8767896789",
  "9899965678"
âŸ©
day9Input â† ParseHeightMap ReadInput 9

Rotate â† (â‰âŒ½)âˆ˜âŠ¢âŸâŠ£ # counter clockwise
LowPoints â† {âˆ§Â´ğ•©âŠ¸(âŠ£<((-âŠ¢) Rotate 10âŠ¸Â»Ë˜âˆ˜RotateËœ))Â¨ â†•4}

RiskLevelSum â† (+Â´â¥Š)âˆ˜(1âŠ¸+Ã—LowPoints)

! 15 = RiskLevelSum day9ExampleData

â€¢Out "Day 9.1: "âˆ¾â€¢Fmt RiskLevelSum day9Input

# part 2

NumberBasins â† ((1âŠ¸+âŠ’âŒ¾â¥Š)Ã—âŠ¢)âˆ˜LowPoints
_addNeighbors_ â† {ğ•— ((-ğ•©)âŠ¸Rotate)âˆ˜(âŠ¢âŒˆ((<âŸœ9âŠ£)âˆ§Â»Ë˜âˆ˜âŠ¢))â—‹(ğ•©âŠ¸Rotate) ğ•˜}
BasinStep â† {âŒˆÂ´(ğ•¨ _addNeighbors_ ğ•©)Â¨ â†•4}
Basins â† {ğ•©âŠ¸BasinStep _fix NumberBasins ğ•©}
LargestBasinsProduct â† {Ã—Â´ 3â†‘ âˆ¨ 1â†“ â‰ Â¨ âŠ”â¥ŠBasins ğ•©}

! 1134 = LargestBasinsProduct day9ExampleData

â€¢Out "Day 9.2: "âˆ¾â€¢Fmt LargestBasinsProduct day9Input
