#!/usr/bin/env BQN

#
# Utilities
#

IsAsciiNum â† ('0'âŠ¸â‰¤âˆ§â‰¤âŸœ'9')

ReadInt â† {(ğ•¨âŠ¸Ã—+âŠ£)Â´âˆ˜âŒ½-âŸœ'0'ğ•©} # stolen from leah2
ReadDec â† 10âŠ¸ReadInt

ReadInput â† {â€¢file.Lines âˆ¾ â€¢pathâ€¿"/input/day"â€¿(â€¢Fmt ğ•©)}

SplitOn â† ((âŠ¢ (-1Ë™)âŸâŠ£Â¨ +`)âˆ˜=âŠ”âŠ¢)

_fix â† {ğ•© ğ•Šâˆ˜âŠ¢âŸâ‰¢ ğ”½ ğ•©}

#
# 2021-12-01
#

# part 1

day1ExampleInput â† 199â€¿200â€¿208â€¿210â€¿200â€¿207â€¿240â€¿269â€¿260â€¿263
day1Input â† ReadDecÂ¨ReadInput 1

# NB: Because distance from the ground is never smaller than zero, it's
# no problem that nudge inserts a zero at the end of the right list
PositiveDeltaCount â† +Â´âˆ˜(âŠ¢<Â«)+ËË˜âˆ˜â†•

! 7 = 1 PositiveDeltaCount day1ExampleInput

â€¢Out "Day 1.1: "âˆ¾â€¢Fmt 1 PositiveDeltaCount day1Input

# part 2

! 5 = 3 PositiveDeltaCount day1ExampleInput

â€¢Out "Day 1.2: "âˆ¾â€¢Fmt 3 PositiveDeltaCount day1Input

#
# 2021-12-02
#

# part 1

day2ExampleInput â† âŸ¨
  "forward 5",
  "down 5",
  "forward 8",
  "up 3",
  "down 8",
  "forward 2",
âŸ©

day2Input â† ReadInput 2

ParseSubmarineCommand â† (((â†•2)âŠ¸((((-1)âŠ¸â‹†)âˆ˜(2âŠ¸|))Ã—(=âŸœ(âŒŠâˆ˜(Ã·âŸœ2))))âˆ˜("duf"âŠ¸âŠ)âˆ˜âŠ‘)Ã—ReadDecâˆ˜(IsAsciiNum/âŠ¢))

SubmarineDestProduct â† {Ã—Â´+Â´ParseSubmarineCommandÂ¨ğ•©}

! 150 = SubmarineDestProduct day2ExampleInput

â€¢Out "Day 2.1: "âˆ¾â€¢Fmt SubmarineDestProduct day2Input

# part 2

SubmarineAimedDestProduct â† {
  Ã—Â´+Â´((Ã—Â´)âˆ˜(1âŠ¸â†“)â‰(1âŠ¸âŠ‘))Â¨ (<0â€¿0â€¿0) (âŠ¢âˆ¾((âŠ‘âˆ˜âŒ½âŠ£)+(âŠ‘âŠ¢)))` ParseSubmarineCommandÂ¨ğ•©
}

! 900 = SubmarineAimedDestProduct day2ExampleInput

â€¢Out "Day 2.2: "âˆ¾â€¢Fmt SubmarineAimedDestProduct day2Input

#
# 2021-12-03
#

BinTable â† '0'-Ëœ>

day3ExampleInput â† BinTable âŸ¨
  "00100",
  "11110",
  "10110",
  "10111",
  "10101",
  "01111",
  "00111",
  "11100",
  "10000",
  "11001",
  "00010",
  "01010",
âŸ©

day3Input â† BinTable ReadInput 3

DeBinList â† ((2âŠ¸Ã—)+âŠ£)Â´âŒ½
_tableAggr â† {((Ã·âŸœ2)âˆ˜(/âŸœâ¥Š)Â´âˆ˜âŒ½âˆ˜â‰¢ğ”½(+Ë))ğ•©}
GammaRate â† < _tableAggr

! 22 = DeBinList GammaRate day3ExampleInput
! 9  = DeBinList Â¬GammaRate day3ExampleInput

â€¢Out "Day 3.1: "âˆ¾â€¢Fmt (Â¬Ã—â—‹DeBinListâŠ¢) GammaRate day3Input

_lifeSupportRating â† {
  # Need to rename the arguments, otherwise the ternary expr becomes a function
  bitPos â† ğ•¨
  Cmp â† ğ”½

  crit â† Cmp _tableAggr ğ•©
  matchPos â† bitPos âŠ‘Ë˜ crit ((â¥ŠËœâŸœâ‰¢)=âŠ¢) ğ•©
  match â† matchPos/ğ•©
  {1=â‰ match?âŠmatch;(bitPos+1) Cmp _lifeSupportRating match}
}

OxygenGeneratorRating â† DeBinList 0 â‰¤_lifeSupportRating âŠ¢
CO2ScrubberRating â† DebinList 0 >_lifeSupportRating âŠ¢

! 23 = OxygenGeneratorRating day3ExampleInput
! 10 = CO2ScrubberRating day3ExampleInput

â€¢Out "Day 3.2: "âˆ¾â€¢Fmt (OxygenGeneratorRatingÃ—CO2ScrubberRating) day3Input

#
# 2021-12-07
#

# part 1

day6ExampleInput â† âŸ¨16,1,2,0,4,2,7,1,2,14âŸ©
day6Input â† ReadDecÂ¨ ','  SplitOn âŠ‘ReadInput 6

PossiblePositions â† (âŒŠÂ´+âŸœ(â†•1âŠ¸+)âŒˆÂ´)
FuelConsumption â† +Ëâˆ˜|âˆ˜(-âŒœ)
_lowestFuelPossible â† {âŒŠÂ´âˆ˜(ğ”½âŸœPossiblePositions)Ëœ ğ•©}

! 37 = FuelConsumption _lowestFuelPossible day6ExampleInput

â€¢Out "Day 7.1: "âˆ¾â€¢Fmt FuelConsumption _lowestFuelPossible day6Input

# part 2

TriNum â† 1âŠ¸+Ã—Ã·âŸœ2

FuelConsumption2 â† +Ëâˆ˜(TriNumÂ¨)âˆ˜|âˆ˜(-âŒœ)

! 168 = FuelConsumption2 _lowestFuelPossible day6ExampleInput

â€¢Out "Day 7.2: "âˆ¾â€¢Fmt FuelConsumption2 _lowestFuelPossible day6Input

#
# 2021-12-09
#

# part 1

ParseHeightMap â† ((â‰ â‰(â‰ âŠ‘))â¥Šâˆ¾)âˆ˜-âŸœ'0'

day9ExampleInput â† ParseHeightMap âŸ¨
  "2199943210",
  "3987894921",
  "9856789892",
  "8767896789",
  "9899965678"
âŸ©
day9Input â† ParseHeightMap ReadInput 9

Rotate â† (â‰âŒ½)âˆ˜âŠ¢âŸâŠ£ # counter clockwise
LowPoints â† {âˆ§Â´ğ•©âŠ¸(âŠ£<((-âŠ¢) Rotate âˆâŠ¸Â»Ë˜âˆ˜RotateËœ))Â¨ â†•4}

RiskLevelSum â† (+Â´â¥Š)âˆ˜(1âŠ¸+Ã—LowPoints)

! 15 = RiskLevelSum day9ExampleInput

â€¢Out "Day 9.1: "âˆ¾â€¢Fmt RiskLevelSum day9Input

# part 2

NumberBasins â† ((1âŠ¸+âŠ’âŒ¾â¥Š)Ã—âŠ¢)âˆ˜LowPoints
Basins â† {ğ•©âŠ¸((<âŸœ9âŠ£)âˆ§(Â«âŒˆÂ»âŒˆÂ«Ë˜âŒˆÂ»Ë˜âŒˆâŠ¢)âˆ˜âŠ¢) _fix NumberBasins ğ•©}
LargestBasinsProduct â† {Ã—Â´ 3â†‘ âˆ¨ 1â†“ â‰ Â¨ âŠ”â¥ŠBasins ğ•©}

! 1134 = LargestBasinsProduct day9ExampleInput

â€¢Out "Day 9.2: "âˆ¾â€¢Fmt LargestBasinsProduct day9Input

#
# 2021-12-13
#

SplitFoldingInstructions â† ("fold along"âŠ¸(âŠ£â‰¡â‰ âŠ¸â†‘)Â¨âŠ”âŠ¢)âˆ˜(0âŠ¸(â‰ âŸœâ‰ Â¨/âŠ¢))
day13ExampleInput â† SplitFoldingInstructions âŸ¨
  "6,10",
  "0,14",
  "9,10",
  "0,3",
  "10,4",
  "4,11",
  "6,0",
  "6,12",
  "4,1",
  "0,13",
  "10,12",
  "3,4",
  "3,0",
  "8,4",
  "1,10",
  "2,14",
  "8,10",
  "9,0",
  "",
  "fold along y=7",
  "fold along x=5",
âŸ©
day13Input â† SplitFoldingInstructions ReadInput 13

ParseDots â† ReadDecÂ¨âˆ˜(','âŠ¸SplitOn)Â¨
ParseFolds â† (âŠ‘âˆ˜'y'âŠ¸âˆŠâ‰ReadDecâˆ˜(IsAsciiNum/âŠ¢))Â¨
day13ExampleDots â† ParseDots âŠ‘ day13ExampleInput

# part 1

# ğ•¨=0 => x, ğ•¨=1 => y
# ğ•© is coordinate to fold around
# ğ•— is input dot list (see ParseDots)
_Fold â† {â·âˆ˜((ğ•©âŠ¸(((2âŠ¸Ã—âŠ£)-âŠ¢)âŒŠâŠ¢)âˆ˜âŠ‘â‰1âŠ¸âŠ‘)Â¨âŒ¾(âŒ½Â¨âŸğ•¨)) ğ•—}

! 17 = â‰  1 day13ExampleDots _Fold 7

day13Dots â† ParseDots âŠ‘ day13Input
day13Folds â† ParseFolds 1 âŠ‘ day13Input

â€¢Out "Day 13.1: "âˆ¾â€¢Fmt â‰  (day13Dots _Fold)Â´ âŠ‘day13Folds

# part 2

PerformAllFolds â† {ğ•© {(ğ•¨ _Fold)Â´ğ•©}ËœÂ´ âŒ½ğ•¨}
DotMatrix â† {
  âŸ¨width, heightâŸ© â† 1+âŒˆËâˆ˜â€¿2â¥Šâˆ¾ğ•©
  {ğ•©? 'â–ˆ';' '}Â¨ heightâ€¿widthâ¥Šâ‰ Â¨âŠ”((âŠ£+(widthâŠ¸Ã—)âˆ˜âŠ¢)Â´)Â¨ ğ•©
}

â€¢Out "Day 13.2:"
â€¢Out â€¢Fmt DotMatrix day13Folds PerformAllFolds day13Dots
