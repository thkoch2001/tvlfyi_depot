{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "f44c866b_2c65ef12",
        "filename": "tvix/Cargo.lock",
        "patchSetId": 2
      },
      "lineNbr": 1437,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-27T09:43:09Z",
      "side": 1,
      "message": "oO",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bde033f0_8c414d7f",
        "filename": "tvix/Cargo.lock",
        "patchSetId": 2
      },
      "lineNbr": 1437,
      "author": {
        "id": 1000110
      },
      "writtenOn": "2024-06-27T13:57:06Z",
      "side": 1,
      "message": "hmm https://github.com/TrueLayer/reqwest-middleware/blob/1c31f4bc7f5b6bf0950f22cbc0936d47e5305ec5/reqwest-tracing/Cargo.toml#L54",
      "parentUuid": "f44c866b_2c65ef12",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e90331ae_fa57320c",
        "filename": "tvix/Cargo.lock",
        "patchSetId": 2
      },
      "lineNbr": 1437,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-29T17:46:00Z",
      "side": 1,
      "message": "Yeah, it\u0027s conditional on the arch, and `Cargo.nix` only adds it if we compile for WASM, so this is fine.",
      "parentUuid": "bde033f0_8c414d7f",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7cb7b140_e82d30ee",
        "filename": "tvix/store/src/pathinfoservice/nix_http.rs",
        "patchSetId": 2
      },
      "lineNbr": 49,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-27T09:43:09Z",
      "side": 1,
      "message": "Did you take a look at how to extend `object_store` to use it too?\n\nI only saw https://docs.rs/object_store/latest/object_store/struct.ClientOptions.html#method.with_default_headers, but no way to plug in a reqwest middleware - even though they\u0027re using it under the hood.\n\nMight be worth opening an issue upstream to open that.\n\nI\u0027m not convinced yet we should send W3C trace contexts there by default - after all, [everyone seems to require their own header formats](https://docs.aws.amazon.com/AmazonS3/latest/userguide/tracing_requests_using_xray.html), so we might need to make it configurable at some point, but I feel like we should at least make sure we have an option to do so with the `object_store` crate.",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e034ec2c_684a97e9",
        "filename": "tvix/store/src/pathinfoservice/nix_http.rs",
        "patchSetId": 2
      },
      "lineNbr": 49,
      "author": {
        "id": 1000110
      },
      "writtenOn": "2024-06-27T13:57:06Z",
      "side": 1,
      "message": "yeah i forgot about object store, but it seems like they are only exposing the reqwest interface, and we dont really want `with_default_headers` because those are static. What we kinda need is a way to run a function prior to making a reqwest which then inserts the current span id. Currently the only way to achieve this is the external reqwest-middleware crate which wraps the client (and a couple of other things) to achieve this. There is an issue in reqwest upstream https://github.com/seanmonstar/reqwest/issues/155 that would be about that.\n\nSo yeah i think we need to open a new issue in object_store upstream and ask if we could wrap/extend this.\n\nregarding \"W3C trace contexts\", they also use the injector similar what we do in grpc: https://github.com/TrueLayer/reqwest-middleware/blob/reqwest-tracing-v0.4.7/reqwest-tracing/src/otel.rs#L64-L97",
      "parentUuid": "7cb7b140_e82d30ee",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a862c01_3f8c8354",
        "filename": "tvix/store/src/pathinfoservice/nix_http.rs",
        "patchSetId": 2
      },
      "lineNbr": 49,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-29T17:46:00Z",
      "side": 1,
      "message": "Ok, would you mind opening an issue about this with `object_store` upstream? And/or update `TODO.md` to relect the current state?",
      "parentUuid": "e034ec2c_684a97e9",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c92b852f_bd8e630d",
        "filename": "tvix/tracing/Cargo.toml",
        "patchSetId": 2
      },
      "lineNbr": 44,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-29T17:46:00Z",
      "side": 1,
      "message": "needs an update on the feature matrix in `tracing/default.nix`.",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84a1cb34_65433358",
        "filename": "tvix/tracing/src/lib.rs",
        "patchSetId": 2
      },
      "lineNbr": 20,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-29T17:46:00Z",
      "side": 1,
      "message": "We can probably just drop that conditional, no?\n\n`mod.rs` will essentially just be an empty mod if you don\u0027t have any of these two features enabled.",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "877f4c9e_923bd823",
        "filename": "tvix/tracing/src/propagate/reqwest.rs",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 1000036
      },
      "writtenOn": "2024-06-27T09:43:09Z",
      "side": 1,
      "message": "Can you link to the RFC, or some docs describing the header that\u0027s being used by default? \n\nI assume it\u0027s https://www.w3.org/TR/trace-context/?",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "150db0d7_7ed11cf8",
        "filename": "tvix/tracing/src/propagate/reqwest.rs",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 1000110
      },
      "writtenOn": "2024-06-27T13:57:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "877f4c9e_923bd823",
      "revId": "e80bce053f9bbc4840a0aab09981ebb8291ea74e",
      "serverId": "4fdfa107-4df9-4596-8e0a-1d2bbdd96e36"
    }
  ]
}